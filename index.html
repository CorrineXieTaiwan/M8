<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>M8 護理排班系統</title>
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Noto Sans TC', "Microsoft JhengHei UI", "微軟正黑體", sans-serif;
            padding: 20px;
            max-width: 1400px;
            margin: 0 auto;
            padding-bottom: 150px;
            transition: padding-bottom 0.3s ease;
        }
        * {
            font-family: 'Noto Sans TC', "Microsoft JhengHei UI", "微軟正黑體", sans-serif;
        }
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Noto Sans TC', "Microsoft JhengHei UI", "微軟正黑體", sans-serif;
        }
        button,
        select,
        input,
        option {
            font-family: 'Noto Sans TC', "Microsoft JhengHei UI", "微軟正黑體", sans-serif;
        }
        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        .nav-buttons {
            display: flex;
            gap: 10px;
        }
        .nav-button {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            background-color: #f0f0f0;
            cursor: pointer;
        }
        .nav-button.active {
            background-color: #42a5f5;
            color: white;
        }
        .shift-groups {
            display: grid;
            grid-template-columns: 1fr;
            gap: 20px;
            margin-bottom: 20px;
        }
        .shift-section {
            margin-bottom: 20px;
            padding: 15px;
            border-left: 4px solid #2196f3;
            background-color: #f8f9fa;
            min-height: auto;
            overflow-x: auto;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
            border-radius: 4px;
        }
        .shift-header {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        .shift-title {
            font-weight: bold;
            margin-right: 15px;
            color: #2196f3;
            width: 80px;
        }
        .shift-column-headers {
            display: grid;
            grid-template-columns: 150px 100px 120px 1fr 200px 200px 40px;
            gap: 10px;
            padding: 8px;
            border-bottom: 1px solid #ddd;
            background-color: #f0f0f0;
            font-weight: bold;
            margin-bottom: 10px;
        }
        .column-header {
            text-align: center;
            color: #2196f3;
            font-size: 0.9em;
        }
        .care-group {
            display: grid;
            grid-template-columns: 150px 100px 120px 1fr 200px 200px 40px;
            gap: 10px;
            padding: 8px;
            border-bottom: 1px solid #eee;
            background-color: white;
            align-items: center;
            justify-items: center;
            margin-bottom: 5px;
            height: 80px;
            overflow: visible;
        }
        .care-group.selected {
            background-color: #e3f2fd;
        }
        .bed-overview {
            position: fixed;
            bottom: -300px;
            left: 50%;
            transform: translateX(-50%);
            background: white;
            padding: 15px 20px;
            border-top: 1px solid #ddd;
            border-radius: 8px 8px 0 0;
            box-shadow: 0 -2px 10px rgba(0, 0, 0, 0.1);
            z-index: 100;
            transition: bottom 0.3s ease;
            width: 90%;
            max-width: 1200px;
            height: 190px;
        }
        .bed-overview.show {
            bottom: 100px;
        }
        .bed-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(50px, 1fr));
            gap: 6px;
            margin-top: 8px;
            overflow-y: auto;
            max-height: 140px;
        }
        .bed-button {
            padding: 10px 5px;
            border: 1px solid #ddd;
            border-radius: 4px;
            text-align: center;
            cursor: pointer;
            background: white;
            min-width: 45px;
            max-width: 100%;
            height: 42px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            font-size: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 500;
        }
        .bed-button.selected {
            background-color: #42a5f5;
            color: white;
        }
        .bed-button.assigned-care {
            background-color: rgba(66, 165, 245, 0.2);
            border-color: #42a5f5;
        }
        .bed-button.assigned-discharge {
            background-color: rgba(255, 82, 82, 0.2);
            border-color: #ff5252;
        }
        .bed-button.assigned-admission {
            background-color: rgba(76, 175, 80, 0.2);
            border-color: #4caf50;
        }
        .add-group-button {
            display: none;
        }
        .nurse-select,
        select,
        input {
            height: 32px;
            min-height: 32px;
            max-height: 32px;
            margin: 0 auto;
            display: block;
            width: 90%;
            text-align-last: center;
            text-align: center;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        input[type="number"] {
            width: 100%;
            padding: 4px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        .bed-display {
            display: flex;
            flex-wrap: wrap;
            gap: 2px;
            min-height: 32px;
            max-height: 150px;
            padding: 4px;
            border: 1px dashed #ddd;
            border-radius: 4px;
            cursor: pointer;
            width: 95%;
            overflow-y: auto;
            align-content: flex-start;
            position: relative;
            z-index: 1;
            margin: 0 auto;
        }
        .bed-display.active {
            border-color: #42a5f5;
            background-color: rgba(66, 165, 245, 0.1);
        }
        .bed-display.discharge.active {
            border-color: #ff5252;
            background-color: rgba(255, 82, 82, 0.1);
        }
        .bed-display.admission.active {
            border-color: #4caf50;
            background-color: rgba(76, 175, 80, 0.1);
        }
        .bed-tag {
            background-color: #42a5f3;
            color: white;
            padding: 2px 4px;
            border-radius: 3px;
            font-size: 0.85em;
            display: inline-flex;
            margin: 1px;
            flex-shrink: 0;
            align-items: center;
            justify-content: center;
            width: 55px;
            height: 20px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            box-sizing: border-box;
            font-family: 'Noto Sans TC', "Microsoft JhengHei UI", "微軟正黑體", sans-serif;
        }
        .bed-tag.discharge {
            background-color: #ff5252;
            width: 55px;
        }
        .bed-tag.admission {
            background-color: #4caf50;
            width: 55px;
        }
        .bed-field {
            cursor: pointer;
            width: 100%;
            position: relative;
            height: 100%;
        }
        .bed-field-label {
            font-size: 0.8em;
            color: #666;
            margin-bottom: 1px;
            white-space: nowrap;
        }
        .nurse-management {
            margin: 20px 0;
            padding: 15px;
            background-color: #f8f9fa;
            border-radius: 4px;
        }
        .nurse-input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
        }
        .nurse-input-group input {
            flex: 1;
            max-width: 200px;
        }
        .nurse-input-group button {
            padding: 4px 12px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .nurse-list {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
        }
        .nurse-tag {
            padding: 4px 8px;
            background-color: #e3f2fd;
            border: 1px solid #90caf9;
            border-radius: 4px;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .nurse-tag button {
            border: none;
            background: none;
            color: #f44336;
            cursor: pointer;
            padding: 0;
            font-size: 16px;
        }
        .modal-backdrop {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
        }
        .modal {
            display: none;
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            z-index: 1001;
            width: 300px;
        }
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        .modal-close {
            border: none;
            background: none;
            font-size: 20px;
            cursor: pointer;
            color: #666;
        }
        .add-nurse-button {
            padding: 12px 24px;
            background-color: #2196f3;
            color: white;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .action-buttons {
            position: fixed;
            bottom: 20px;
            right: 20px;
            display: flex;
            flex-direction: row;
            gap: 10px;
            z-index: 1000;
        }
        .floating-add-button {
            padding: 12px 24px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .toggle-bed-overview {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            padding: 8px 16px;
            background-color: #2196f3;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            z-index: 101;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        }
        .bed-overview.show + .toggle-bed-overview {
            bottom: 330px;
        }
        @keyframes flash-red {
            0%, 100% { 
                background-color: white;
                border-color: #ddd;
            }
            50% { 
                background-color: #ffebee;
                border-color: #f44336;
            }
        }
        .bed-button.duplicate {
            animation: flash-red 0.5s ease 2;
            border-color: #f44336;
        }
        .bed-tag:hover {
            opacity: 0.8;
        }
        body.overview-hidden {
            padding-bottom: 150px;
        }
        h1, h2, h3 {
            font-family: "Microsoft JhengHei UI", "微軟正黑體", sans-serif;
        }
        .remove-button {
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 50%;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-weight: bold;
            transition: background-color 0.2s;
        }
        .remove-button:hover {
            background-color: #d32f2f;
        }
        .action-header {
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 15px 25px;
            background-color: #4CAF50;
            color: white;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
            transform: translateX(200%);
            transition: transform 0.3s ease-out;
            z-index: 1000;
        }
        
        .notification.show {
            transform: translateX(0);
        }
        
        .floating-save-button {
            padding: 12px 24px;
            background-color: #FF9800;
            color: white;
            border: none;
            border-radius: 24px;
            cursor: pointer;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
            margin-right: 10px;
        }
        /* 床號概覽標題區域 */
        .bed-overview-header {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 30px;
            margin-bottom: 15px;
            text-align: center;
        }
        .bed-overview h3 {
            margin: 0;
            font-size: 18px;
            color: #2196f3;
            font-weight: 600;
            text-align: center;
        }
        /* 重置床號按鈕 */
        .reset-beds-button {
            padding: 8px 16px;
            background-color: #f44336;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: background-color 0.3s;
            font-weight: 500;
        }
        .reset-beds-button:hover {
            background-color: #d32f2f;
        }
        /* 標題容器樣式 */
        .title-container {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 20px;
            position: relative;
            width: 100%;
            min-width: 1000px;
            padding: 0 20px;
        }
        .title-left {
            display: flex;
            align-items: center;
            gap: 20px;
            flex-shrink: 0;
        }
        .title-right {
            display: flex;
            align-items: center;
            gap: 30px;
            flex-shrink: 0;
        }
        .head-nurse {
            font-size: 1.5rem;
            color: #2196f3;
            font-weight: 500;
            white-space: nowrap;
            border-left: 2px solid #90caf9;
            padding-left: 20px;
        }
        /* 添加医院标志样式 */
        .hospital-logo {
            height: 50px;
            width: auto;
            object-fit: contain;
        }
        /* 修改日期时间显示样式 */
        .datetime-display {
            text-align: right;
            color: #333;
            min-width: 220px;
            white-space: nowrap;
        }
        .datetime-line {
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 30px; /* 增加间距 */
        }
        #currentDate {
            font-size: 1.5rem; /* 增大字体 */
            font-weight: 600; /* 加粗字体 */
            color: #333; /* 改为黑色 */
        }
        #currentTime {
            font-size: 1.6rem; /* 增大字体 */
            font-weight: 700; /* 更加粗的字体 */
            color: #333;
        }
        /* 添加预约研究床號日期样式 */
        .research-bed-reservation {
            background-color: #f8f9fa;
            border-radius: 8px;
            padding: 15px 20px;
            margin: 20px 0 60px 0;
            box-shadow: 0 1px 3px rgba(0,0,0,0.1);
        }
        .research-bed-title {
            color: #2196f3;
            margin-top: 0;
            margin-bottom: 15px;
            font-size: 1.2em;
            border-bottom: 1px solid #e0e0e0;
            padding-bottom: 10px;
        }
        .research-bed-container {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }
        .research-bed-input-group {
            display: flex;
            gap: 10px;
            align-items: center;
        }
        .research-bed-date {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex: 0 0 200px;
        }
        .research-bed-note {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            flex: 1;
        }
        .research-bed-add-btn {
            padding: 8px 16px;
            background-color: #4caf50;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
        }
        .research-bed-list {
            display: flex;
            flex-direction: column;
            gap: 8px;
            max-height: 200px;
            overflow-y: auto;
        }
        .research-bed-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 15px;
            background-color: white;
            border-radius: 4px;
            border-left: 4px solid #2196f3;
        }
        .research-bed-info {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        .research-bed-date-display {
            font-weight: 500;
            color: #2196f3;
        }
        .research-bed-note-display {
            color: #555;
        }
        .research-bed-delete {
            color: #f44336;
            cursor: pointer;
            font-size: 18px;
            font-weight: bold;
        }
        /* 调整床號概览按钮位置，确保不被研究床號区域遮挡 */
        .bed-overview-toggle {
            position: fixed;
            bottom: 80px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 101;
        }
        /* 美化新增護理師彈出視窗 */
        .modal-form-group {
            margin-bottom: 15px;
        }
        
        .modal-form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
            color: #333;
        }
        
        .modal-form-group input {
            width: 100%;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 4px;
            box-sizing: border-box;
            height: 36px;
        }
        
        .modal-buttons {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
            margin-top: 20px;
        }
        
        .modal-button {
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 500;
            border: none;
        }
        
        .modal-button.cancel {
            background-color: #f5f5f5;
            color: #333;
        }
        
        .modal-button.submit {
            background-color: #4caf50;
            color: white;
        }
        .title-container h1 {
            font-family: 'Noto Sans TC', "Microsoft JhengHei UI", "微軟正黑體", sans-serif;
            font-weight: 700;
        }
    </style>
</head>
<body>
    <div class="header">
        <div class="title-container">
            <div class="title-left">
                <h1>M8 護理排班系統</h1>
                <span class="head-nurse">病房護理長：鐘黛瑩</span>
            </div>
            <div class="title-right">
                <div class="datetime-display">
                    <div class="datetime-line">
                        <span id="currentDate"></span>
                        <span id="currentTime"></span>
                    </div>
                </div>
                <img src="images/Chung_Shan_Medical_University_seal.svg.png" alt="中山醫學大學附設醫院" class="hospital-logo">
            </div>
        </div>
    </div>

    <div class="modal-backdrop" id="modalBackdrop"></div>
    <div class="modal" id="nurseModal">
        <div class="modal-header">
            <h3>新增護理師</h3>
            <button class="modal-close" onclick="hideModal()">&times;</button>
        </div>
        <div class="modal-content">
            <div class="modal-form-group">
                <input type="text" id="nurseInput" placeholder="請輸入護理師姓名">
            </div>
            <div class="modal-buttons">
                <button class="modal-button cancel" onclick="hideModal()">取消</button>
                <button class="modal-button submit" onclick="addNurseAndClose()">新增</button>
            </div>
        </div>
    </div>

    <div class="shift-groups" id="shiftGroups">
        <!-- 白班 -->
        <div class="shift-section">
            <div class="shift-header">
                <span class="shift-title">白班</span>
                <button class="add-group-button" onclick="addCareGroup('白班')">新增照護組別</button>
            </div>
            <div class="shift-column-headers">
                <div class="column-header">護理師</div>
                <div class="column-header">點班</div>
                <div class="column-header">消防編組</div>
                <div class="column-header">照護床號</div>
                <div class="column-header">出院床號</div>
                <div class="column-header">入院床號</div>
                <div class="column-header"></div>
            </div>
            <div id="白班-groups"></div>
        </div>

        <!-- 小夜班 -->
        <div class="shift-section">
            <div class="shift-header">
                <span class="shift-title">小夜班</span>
                <button class="add-group-button" onclick="addCareGroup('小夜班')">新增照護組別</button>
            </div>
            <div class="shift-column-headers">
                <div class="column-header">護理師</div>
                <div class="column-header">點班</div>
                <div class="column-header">消防編組</div>
                <div class="column-header">照護床號</div>
                <div class="column-header">出院床號</div>
                <div class="column-header">入院床號</div>
                <div class="column-header"></div>
            </div>
            <div id="小夜班-groups"></div>
        </div>

        <!-- 大夜班 -->
        <div class="shift-section">
            <div class="shift-header">
                <span class="shift-title">大夜班</span>
                <button class="add-group-button" onclick="addCareGroup('大夜班')">新增照護組別</button>
            </div>
            <div class="shift-column-headers">
                <div class="column-header">護理師</div>
                <div class="column-header">點班</div>
                <div class="column-header">消防編組</div>
                <div class="column-header">照護床號</div>
                <div class="column-header">出院床號</div>
                <div class="column-header">入院床號</div>
                <div class="column-header"></div>
            </div>
            <div id="大夜班-groups"></div>
        </div>
    </div>

    <div class="bed-overview">
        <div class="bed-overview-header">
            <h3>床號概覽</h3>
            <button class="reset-beds-button" onclick="resetAllBeds()">重置所有床號</button>
        </div>
        <div class="bed-grid">
            <!-- 床號按鈕會由 JavaScript 動態生成 -->
        </div>
    </div>

    <!-- 新增浮動按鈕組 -->
    <div class="action-buttons">
        <button class="floating-add-button" id="addGroupButton">新增照護組別</button>
        <button class="add-nurse-button" onclick="showModal()">新增護理師</button>
        <button class="floating-save-button" onclick="saveScheduleData()">保存排班</button>
    </div>

    <button class="toggle-bed-overview" id="toggleBedOverview">
        顯示床號概覽
    </button>

    <div class="notification"></div>

    <!-- 在页面底部添加预约研究床號日期区域，放在床號概覽按钮上方 -->
    <div class="research-bed-reservation">
        <h3 class="research-bed-title">預約研究床號日期</h3>
        <div class="research-bed-container">
            <div class="research-bed-input-group">
                <input type="date" id="researchBedDate" class="research-bed-date">
                <input type="text" id="researchBedNote" class="research-bed-note" placeholder="輸入預約備註">
                <button class="research-bed-add-btn" onclick="addResearchBedReservation()">新增預約</button>
            </div>
            <div class="research-bed-list" id="researchBedList">
                <!-- 预约记录将在这里动态生成 -->
            </div>
        </div>
    </div>

    <script src="js/shared-navigation.js"></script>

    <script>
        // 从 localStorage 获取护理师列表
        let nurses = new Set();
        let assignedNurses = new Set();
        let levels = new Set();
        let fireTeams = new Set();
        let scheduleData = {};

        // 初始化护理师列表
        function initializeNurses() {
            const savedNurses = localStorage.getItem('nurseList');
            if (savedNurses) {
                nurses = new Set(JSON.parse(savedNurses));
            } else {
                // 预设护理师名单（仅在没有保存的名单时使用）
                const defaultNurses = [
                    "謝靜伊",
                    "王小明",
                    "周杰倫",
                    "高小美",
                    "蔡阿嘎"
                ];
                nurses = new Set(defaultNurses);
            }
            updateAllNurseSelects();
        }

        // 修改新增護理師的彈窗標題和提示
        document.querySelector('#nurseModal h3').textContent = '新增護理師';
        document.querySelector('#nurseInput').placeholder = '請輸入護理師姓名';

        // 修改新增護理師按鈕的文字
        document.querySelector('.add-nurse-button').textContent = '新增護理師';

        function showModal() {
            document.getElementById('modalBackdrop').style.display = 'block';
            document.getElementById('nurseModal').style.display = 'block';
            document.getElementById('nurseInput').focus();
        }

        function hideModal() {
            document.getElementById('modalBackdrop').style.display = 'none';
            document.getElementById('nurseModal').style.display = 'none';
            document.getElementById('nurseInput').value = '';
        }

        function addNurseAndClose() {
            const input = document.getElementById('nurseInput');
            const name = input.value.trim();
            
            if (name && !nurses.has(name)) {
                nurses.add(name);
                updateAllNurseSelects();
                hideModal();
            } else if (nurses.has(name)) {
                alert('此護理師已存在於名單中');
            }
        }

        // 添加按 Enter 鍵提交功能
        document.getElementById('nurseInput').addEventListener('keypress', function(e) {
            if (e.key === 'Enter') {
                addNurseAndClose();
            }
        });

        // 點擊背景關閉彈窗
        document.getElementById('modalBackdrop').onclick = hideModal;

        // 防止點擊彈窗內容時關閉彈窗
        document.getElementById('nurseModal').onclick = function(e) {
            e.stopPropagation();
        };

        // 修改床號总数为36
        const totalBeds = 36; // 将原来的床號数量修改为36
        
        // 初始化床號数据
        function initializeBeds() {
            const bedGrid = document.querySelector('.bed-grid');
            bedGrid.innerHTML = '';
            
            // 從 localStorage 獲取床號配置
            let bedConfig = JSON.parse(localStorage.getItem('bedConfig')) || {};
            const savedTotalBeds = parseInt(localStorage.getItem('totalBeds')) || totalBeds;
            
            // 生成床號按鈕
            for (let i = 0; i < savedTotalBeds; i++) {
                const button = document.createElement('button');
                const bedId = `bed_${i}`;
                // 使用自定義名稱或默認名稱
                const displayName = bedConfig[bedId] || (i + 1).toString();
                button.textContent = displayName;
                button.dataset.index = i; // 存儲原始索引
                button.className = 'bed-button';
                button.onclick = function() {
                    updateSelectedBeds.call(this);
                };
                bedGrid.appendChild(button);
            }
        }
        
        // 修改床號顯示區域的點擊處理
        function handleBedDisplayClick(displayDiv, type) {
            // 移除所有床號顯示區域的活動狀態
            document.querySelectorAll('.bed-display').forEach(d => d.classList.remove('active'));
            
            // 設置當前點擊的區域為活動狀態
            displayDiv.classList.add('active');
            
            // 更新活動欄位信息
            activeField = {
                element: displayDiv,
                type: type
            };
            
            // 確保床號概覽顯示
            if (!isOverviewVisible) {
                toggleButton.click();
            }
            
            // 更新當前班別的床號狀態
            const currentShiftSection = displayDiv.closest('.shift-section');
            if (currentShiftSection) {
                updateBedButtonsStatus(currentShiftSection);
            }
        }

        // 修改床號點擊處理函數
        function updateSelectedBeds() {
            // 只檢查是否有活動欄位
            if (!activeField) {
                return;
            }
            
            const bedNumber = this.textContent;
            const currentShiftSection = activeField.element.closest('.shift-section');
            
            // 檢查重複 - 只在當前班別內檢查
            let isDuplicate = false;
            const currentShiftGroups = currentShiftSection.querySelectorAll('.care-group');
            
            currentShiftGroups.forEach(group => {
                const display = group.querySelector(`.bed-display.${activeField.type}`);
                if (display) {
                    const bedTags = display.querySelectorAll('.bed-tag');
                    bedTags.forEach(tag => {
                        if (tag.textContent === bedNumber) {
                            isDuplicate = true;
                        }
                    });
                }
            });
            
            if (isDuplicate) {
                this.classList.add('duplicate');
                setTimeout(() => {
                    this.classList.remove('duplicate');
                }, 1000);
                return;
            }
            
            // 創建新的床號標籤
            const bedTag = document.createElement('span');
            bedTag.textContent = bedNumber;
            bedTag.className = `bed-tag ${activeField.type}`;
            
            // 添加刪除事件
            bedTag.onclick = function(e) {
                e.stopPropagation();
                this.remove();
                updateBedButtonsStatus(currentShiftSection);
            };
            
            // 添加到活動欄位
            activeField.element.appendChild(bedTag);
            
            // 更新床號狀態
            updateBedButtonsStatus(currentShiftSection);
        }

        // 修改點擊組別的處理
        function handleGroupClick(groupDiv) {
            // 移除其他組別的選中狀態
            document.querySelectorAll('.care-group').forEach(g => g.classList.remove('selected'));
            
            // 設置當前組別為選中狀態
            groupDiv.classList.add('selected');
            selectedGroup = groupDiv;
            
            // 更新當前班別的床號狀態
            const currentShiftSection = groupDiv.closest('.shift-section');
            updateBedButtonsStatus(currentShiftSection);
        }

        // 修改點擊其他地方的處理
        document.addEventListener('click', function(e) {
            // 只有當點擊的不是床號按鈕、床號顯示區域或其相關元素時才取消選中
            if (!e.target.closest('.bed-display') && 
                !e.target.closest('.bed-button') && 
                !e.target.closest('.bed-tag')) {
                document.querySelectorAll('.bed-display').forEach(d => d.classList.remove('active'));
                activeField = null;
            }
        });

        // 修改更新所有護理師選擇下拉選單的函數
        function updateAllNurseSelects() {
            // 先收集所有已分配的護理師
            const assignedNursesSet = new Set();
            document.querySelectorAll('.nurse-select').forEach(select => {
                if (select.value) {
                    assignedNursesSet.add(select.value);
                }
            });
            
            // 更新每個下拉選單
            document.querySelectorAll('.nurse-select').forEach(select => {
                const currentValue = select.value;
                
                // 清空選單
                select.innerHTML = '<option value="">選擇護理師</option>';
                
                // 添加未分配的護理師選項
                Array.from(nurses).forEach(nurse => {
                    // 如果護理師未被分配或就是當前選中的值，則添加到選單中
                    if (!assignedNursesSet.has(nurse) || nurse === currentValue) {
                        const option = document.createElement('option');
                        option.value = nurse;
                        option.textContent = nurse;
                        if (nurse === currentValue) {
                            option.selected = true;
                        }
                        select.appendChild(option);
                    }
                });
            });
        }

        // 修改護理師選擇事件
        function addCareGroup(shift) {
            const shiftContainer = document.getElementById(`${shift}-groups`);
            if (!shiftContainer) {
                console.error('找不到班別容器:', shift);
                return;
            }

            const groupDiv = document.createElement('div');
            groupDiv.className = 'care-group';
            
            // 護理師選擇下拉選單
            const nurseSelect = document.createElement('select');
            nurseSelect.className = 'nurse-select';
            
            // 添加選擇事件
            nurseSelect.onchange = function() {
                const previousValue = this.dataset.previousValue;
                if (previousValue) {
                    // 移除之前的選擇
                    assignedNurses.delete(previousValue);
                }
                if (this.value) {
                    // 添加新的選擇
                    assignedNurses.add(this.value);
                }
                this.dataset.previousValue = this.value;
                updateAllNurseSelects();
            };
            
            // 初始化選單
            nurseSelect.innerHTML = '<option value="">選擇護理師</option>';
            Array.from(nurses).forEach(nurse => {
                if (!assignedNurses.has(nurse)) {
                    const option = document.createElement('option');
                    option.value = nurse;
                    option.textContent = nurse;
                    nurseSelect.appendChild(option);
                }
            });

            // 點班項目下拉選單
            const levelSelect = document.createElement('select');
            levelSelect.innerHTML = '<option value="">選擇點班</option>';
            Array.from(levels).forEach(level => {
                const option = document.createElement('option');
                option.value = level;
                option.textContent = level;
                levelSelect.appendChild(option);
            });

            // 消防編組下拉選單
            const fireTeamSelect = document.createElement('select');
            fireTeamSelect.innerHTML = '<option value="">選擇編組</option>';
            Array.from(fireTeams).forEach(team => {
                const option = document.createElement('option');
                option.value = team;
                option.textContent = team;
                fireTeamSelect.appendChild(option);
            });

            // 創建床號顯示區域
            const createBedField = (type) => {
                const displayDiv = document.createElement('div');
                displayDiv.className = `bed-display ${type}`;
                displayDiv.onclick = (e) => {
                    e.stopPropagation();
                    handleBedDisplayClick(displayDiv, type);
                };
                return displayDiv;
            };

            const careBedsField = createBedField('care');
            const dischargeBedsField = createBedField('discharge');
            const admissionBedsField = createBedField('admission');

            // 刪除按鈕
            const removeButton = document.createElement('button');
            removeButton.textContent = '×';
            removeButton.className = 'remove-button';
            removeButton.onclick = function(e) {
                e.stopPropagation();
                const nurseValue = nurseSelect.value;
                if (nurseValue) {
                    assignedNurses.delete(nurseValue);
                }
                groupDiv.remove();
                updateAllNurseSelects();
            };

            // 添加所有元素到組別
            groupDiv.appendChild(nurseSelect);
            groupDiv.appendChild(levelSelect);
            groupDiv.appendChild(fireTeamSelect);
            groupDiv.appendChild(careBedsField);
            groupDiv.appendChild(dischargeBedsField);
            groupDiv.appendChild(admissionBedsField);
            groupDiv.appendChild(removeButton);

            // 添加點擊事件
            groupDiv.addEventListener('click', function(e) {
                if (!e.target.closest('.bed-tag')) {
                    handleGroupClick(this);
                }
            });

            shiftContainer.appendChild(groupDiv);
            updateBedButtonsStatus(shiftContainer.closest('.shift-section'));
        }

        // 修改更新床號按鈕狀態的函數
        function updateBedButtonsStatus(currentShiftSection) {
            // 先清除所有床號按鈕的狀態
            document.querySelectorAll('.bed-button').forEach(button => {
                button.className = 'bed-button';
            });

            // 只檢查當前班別內的床號分配
            if (currentShiftSection) {
                const currentShiftGroups = currentShiftSection.querySelectorAll('.care-group');
                currentShiftGroups.forEach(group => {
                    ['care', 'discharge', 'admission'].forEach(type => {
                        const display = group.querySelector(`.bed-display.${type}`);
                        if (display) {
                            const bedTags = display.querySelectorAll('.bed-tag');
                            bedTags.forEach(tag => {
                                const button = Array.from(document.querySelectorAll('.bed-button'))
                                    .find(btn => btn.textContent === tag.textContent);
                                if (button) {
                                    button.classList.add(`assigned-${type}`);
                                }
                            });
                        }
                    });
                });
            }
        }

        // 添加監聽 localStorage 變化的函數
        function setupLocalStorageListener() {
            window.addEventListener('storage', function(e) {
                if (e.key === 'bedConfig' || e.key === 'totalBeds') {
                    // 當床號配置或總床數發生變化時，重新初始化床號
                    initializeBeds();
                    // 更新所有班別的床號狀態
                    document.querySelectorAll('.shift-section').forEach(section => {
                        updateBedButtonsStatus(section);
                    });
                }
            });
        }

        // 確保所有班別區域都正確初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化所有數據
            initializeScheduleData();
            
            // 初始化床號
            initializeBeds();
            
            // 設置 localStorage 監聽器
            setupLocalStorageListener();
            
            // 加載排班數據
            loadScheduleData();
            
            // 加載研究床號數據
            loadResearchBedData();
            
            // 更新所有下拉選單
            updateAllNurseSelects();
            updateLevelList();
            updateFireTeamList();
            
            // 更新日期時間
            updateDateTime();
            
            // 每秒更新一次時間
            setInterval(updateDateTime, 1000);
            
            // 為所有照護組別添加點擊事件
            document.querySelectorAll('.care-group').forEach(group => {
                group.addEventListener('click', function(e) {
                    if (!e.target.closest('.bed-tag')) {
                        handleGroupClick(this);
                    }
                });
            });
        });

        // 初始化排班數據
        function initializeScheduleData() {
            // 從 localStorage 獲取護理師列表
            const savedNurses = localStorage.getItem('nurseList');
            if (savedNurses) {
                nurses = new Set(JSON.parse(savedNurses));
            } else {
                // 預設護理師名單
                const defaultNurses = [
                    "謝靜伊",
                    "王小明",
                    "周杰倫",
                    "高小美",
                    "蔡阿嘎"
                ];
                nurses = new Set(defaultNurses);
            }

            // 從 localStorage 獲取點班項目列表
            const savedLevels = localStorage.getItem('levelList');
            if (savedLevels) {
                levels = new Set(JSON.parse(savedLevels));
            } else {
                // 預設點班項目
                const defaultLevels = ["A", "B", "C", "D"];
                levels = new Set(defaultLevels);
            }

            // 從 localStorage 獲取消防編組列表
            const savedFireTeams = localStorage.getItem('fireTeamList');
            if (savedFireTeams) {
                fireTeams = new Set(JSON.parse(savedFireTeams));
            } else {
                // 預設消防編組
                const defaultFireTeams = [
                    "通報班",
                    "滅火班",
                    "救護班",
                    "避難引導班",
                    "安全防護班"
                ];
                fireTeams = new Set(defaultFireTeams);
            }

            // 從 localStorage 獲取排班數據
            const savedSchedule = localStorage.getItem('scheduleData');
            if (savedSchedule) {
                scheduleData = JSON.parse(savedSchedule);
            } else {
                // 初始化排班數據
                scheduleData = {
                    nurses: Array.from(nurses),
                    levels: Array.from(levels),
                    fireTeams: Array.from(fireTeams),
                    assignments: {}
                };
                localStorage.setItem('scheduleData', JSON.stringify(scheduleData));
            }
        }

        // 修改更新點班項目列表顯示函數
        function updateLevelList() {
            // 更新所有班別中的點班項目下拉選單
            document.querySelectorAll('.care-group select:nth-of-type(2)').forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">選擇點班</option>';
                
                // 使用 Array.from(levels) 而不是排序，保持原有順序
                Array.from(levels).forEach(level => {
                    const option = document.createElement('option');
                    option.value = level;
                    option.textContent = level;
                    if (level === currentValue) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
            });
        }

        // 修改更新消防編組列表顯示函數
        function updateFireTeamList() {
            // 更新所有班別中的消防編組下拉選單
            document.querySelectorAll('.care-group select:nth-of-type(3)').forEach(select => {
                const currentValue = select.value;
                select.innerHTML = '<option value="">選擇消防編組</option>';
                
                // 使用 Array.from(fireTeams) 而不是排序，保持原有順序
                Array.from(fireTeams).forEach(team => {
                    const option = document.createElement('option');
                    option.value = team;
                    option.textContent = team;
                    if (team === currentValue) {
                        option.selected = true;
                    }
                    select.appendChild(option);
                });
            });
        }

        // 修改監聽 localStorage 變化
        window.addEventListener('storage', function(e) {
            if (e.key === 'levelList') {
                const newLevels = new Set(JSON.parse(e.newValue));
                levels = newLevels;
                updateLevelList();
            }
            if (e.key === 'fireTeamList') {
                const newFireTeams = new Set(JSON.parse(e.newValue));
                fireTeams = newFireTeams;
                updateFireTeamList();
            }
        });

        // 保存排班數據到localStorage
        function saveScheduleData() {
            const scheduleData = {
                shifts: {}
            };
            
            // 保存每個班別的數據
            ['白班', '小夜班', '大夜班'].forEach(shift => {
                const shiftGroups = [];
                const groupElements = document.querySelectorAll(`#${shift}-groups .care-group`);
                
                groupElements.forEach(group => {
                    const nurseSelect = group.querySelector('.nurse-select');
                    const levelSelect = group.querySelector('select:nth-of-type(2)');
                    const shiftTypeSelect = group.querySelector('select:nth-of-type(3)');
                    
                    // 获取床號數據
                    const careBeds = Array.from(group.querySelector('.bed-display.care').querySelectorAll('.bed-tag'))
                        .map(tag => tag.textContent);
                    const dischargeBeds = Array.from(group.querySelector('.bed-display.discharge').querySelectorAll('.bed-tag'))
                        .map(tag => tag.textContent);
                    const admissionBeds = Array.from(group.querySelector('.bed-display.admission').querySelectorAll('.bed-tag'))
                        .map(tag => tag.textContent);
                    
                    // 創建組別數據對象
                    const groupData = {
                        nurse: nurseSelect.value,
                        level: levelSelect.value,
                        shiftType: shiftTypeSelect.value,
                        careBeds: careBeds,
                        dischargeBeds: dischargeBeds,
                        admissionBeds: admissionBeds
                    };
                    
                    shiftGroups.push(groupData);
                });
                
                scheduleData.shifts[shift] = shiftGroups;
            });
            
            // 保存到localStorage
            localStorage.setItem('scheduleData', JSON.stringify(scheduleData));
            
            // 顯示保存成功的通知
            showNotification('排班設定已保存');
        }
        
        // 从localStorage加載排班數據
        function loadScheduleData() {
            const savedData = localStorage.getItem('scheduleData');
            if (!savedData) return;
            
            const scheduleData = JSON.parse(savedData);
            
            // 清空現有的組別
            ['白班', '小夜班', '大夜班'].forEach(shift => {
                const container = document.getElementById(`${shift}-groups`);
                if (container) {
                    container.innerHTML = '';
                }
            });
            
            // 恢復每個班別的數據
            Object.keys(scheduleData.shifts).forEach(shift => {
                const shiftGroups = scheduleData.shifts[shift];
                
                shiftGroups.forEach(groupData => {
                    // 創建新的組別
                    addCareGroup(shift);
                    
                    // 获取剛剛創建的組別元素
                    const container = document.getElementById(`${shift}-groups`);
                    const groupElement = container.lastElementChild;
                    
                    // 設置護理師、等級和班別
                    const nurseSelect = groupElement.querySelector('.nurse-select');
                    const levelSelect = groupElement.querySelector('select:nth-of-type(2)');
                    const shiftTypeSelect = groupElement.querySelector('select:nth-of-type(3)');
                    
                    nurseSelect.value = groupData.nurse;
                    levelSelect.value = groupData.level;
                    shiftTypeSelect.value = groupData.shiftType;
                    
                    // 如果選擇了護理師，更新已分配護理師集合
                    if (groupData.nurse) {
                        assignedNurses.add(groupData.nurse);
                        nurseSelect.dataset.previousValue = groupData.nurse;
                    }
                    
                    // 恢復床號數據
                    const careDisplay = groupElement.querySelector('.bed-display.care');
                    const dischargeDisplay = groupElement.querySelector('.bed-display.discharge');
                    const admissionDisplay = groupElement.querySelector('.bed-display.admission');
                    
                    // 添加照護床號
                    groupData.careBeds.forEach(bedNumber => {
                        const bedTag = document.createElement('span');
                        bedTag.textContent = bedNumber;
                        bedTag.className = 'bed-tag care';
                        
                        bedTag.onclick = function(e) {
                            e.stopPropagation();
                            this.remove();
                            updateBedButtonsStatus(groupElement.closest('.shift-section'));
                        };
                        
                        careDisplay.appendChild(bedTag);
                    });
                    
                    // 添加出院床號
                    groupData.dischargeBeds.forEach(bedNumber => {
                        const bedTag = document.createElement('span');
                        bedTag.textContent = bedNumber;
                        bedTag.className = 'bed-tag discharge';
                        
                        bedTag.onclick = function(e) {
                            e.stopPropagation();
                            this.remove();
                            updateBedButtonsStatus(groupElement.closest('.shift-section'));
                        };
                        
                        dischargeDisplay.appendChild(bedTag);
                    });
                    
                    // 添加入院床號
                    groupData.admissionBeds.forEach(bedNumber => {
                        const bedTag = document.createElement('span');
                        bedTag.textContent = bedNumber;
                        bedTag.className = 'bed-tag admission';
                        
                        bedTag.onclick = function(e) {
                            e.stopPropagation();
                            this.remove();
                            updateBedButtonsStatus(groupElement.closest('.shift-section'));
                        };
                        
                        admissionDisplay.appendChild(bedTag);
                    });
                });
            });
            
            // 更新所有護理師選擇下拉選單
            updateAllNurseSelects();
            
            // 更新所有班別的床號狀態
            document.querySelectorAll('.shift-section').forEach(section => {
                updateBedButtonsStatus(section);
            });
        }
        
        // 顯示通知
        function showNotification(message) {
            // 創建通知元素
            const notification = document.createElement('div');
            notification.className = 'notification';
            notification.textContent = message;
            document.body.appendChild(notification);
            
            // 顯示通知
            setTimeout(() => {
                notification.classList.add('show');
            }, 10);
            
            // 3秒後隱藏通知
            setTimeout(() => {
                notification.classList.remove('show');
                setTimeout(() => {
                    notification.remove();
                }, 300);
            }, 3000);
        }

        // 更新日期和時間
        function updateDateTime() {
            const now = new Date();
            
            // 格式化日期：年/月/日 星期几（增加間距）
            const days = ['日', '一', '二', '三', '四', '五', '六'];
            const dateStr = `${now.getFullYear()}/${(now.getMonth() + 1).toString().padStart(2, '0')}/${now.getDate().toString().padStart(2, '0')}   星期${days[now.getDay()]}`;
            
            // 格式化時間：時:分
            const timeStr = `${now.getHours().toString().padStart(2, '0')}:${now.getMinutes().toString().padStart(2, '0')}`;
            
            document.getElementById('currentDate').textContent = dateStr;
            document.getElementById('currentTime').textContent = timeStr;
        }

        // 頁面載入時初始化日期時間，並每秒更新一次
        document.addEventListener('DOMContentLoaded', function() {
            // 初始化日期時間
            updateDateTime();
            
            // 每秒更新一次
            setInterval(updateDateTime, 1000);
            
            // 其他初始化代碼...
        });

        // 頁面切換函數
        function navigateTo(page) {
            // 保存當前頁面標識
            localStorage.setItem('currentPage', page);
            
            // 跳轉到相應頁面
            window.location.href = page;
        }

        // 修改重置所有床號的函數，移除保存排班動作

        // 重置所有床號
        function resetAllBeds() {
            // 清除所有班別中的所有照護組別的床號分配
            ['白班', '小夜班', '大夜班'].forEach(shift => {
                const shiftContainer = document.getElementById(`${shift}-groups`);
                if (shiftContainer) {
                    const careGroups = shiftContainer.querySelectorAll('.care-group');
                    careGroups.forEach(group => {
                        ['care', 'discharge', 'admission'].forEach(type => {
                            const display = group.querySelector(`.bed-display.${type}`);
                            if (display) {
                                display.innerHTML = '';
                            }
                        });
                    });
                }
            });
            
            // 重置所有床號按鈕的狀態
            document.querySelectorAll('.bed-button').forEach(button => {
                button.className = 'bed-button';
            });
            
            // 顯示通知
            showNotification('所有班別的床號已重置');
            
            // 移除保存排班數據的動作
        }

        // 添加预约研究床號相關函數
        // 在script標籤內添加以下代碼

        // 预约研究床號數據
        let researchBedReservations = [];

        // 添加预约
        function addResearchBedReservation() {
            const dateInput = document.getElementById('researchBedDate');
            const noteInput = document.getElementById('researchBedNote');
            
            const date = dateInput.value;
            const note = noteInput.value.trim();
            
            if (!date) {
                showNotification('請選擇預約日期');
                return;
            }
            
            // 創建新预约
            const newReservation = {
                id: Date.now(), // 使用時間戳作為唯一ID
                date: date,
                note: note
            };
            
            // 添加到數組
            researchBedReservations.push(newReservation);
            
            // 更新顯示
            updateResearchBedList();
            
            // 保存到localStorage
            saveResearchBedData();
            
            // 清空輸入
            dateInput.value = '';
            noteInput.value = '';
            
            showNotification('預約研究床號已添加');
        }

        // 删除预约
        function deleteResearchBedReservation(id) {
            researchBedReservations = researchBedReservations.filter(item => item.id !== id);
            updateResearchBedList();
            saveResearchBedData();
            showNotification('預約已刪除');
        }

        // 更新预约列表顯示
        function updateResearchBedList() {
            const listElement = document.getElementById('researchBedList');
            listElement.innerHTML = '';
            
            // 按日期排序
            researchBedReservations.sort((a, b) => new Date(a.date) - new Date(b.date));
            
            researchBedReservations.forEach(reservation => {
                const item = document.createElement('div');
                item.className = 'research-bed-item';
                
                const info = document.createElement('div');
                info.className = 'research-bed-info';
                
                const dateDisplay = document.createElement('div');
                dateDisplay.className = 'research-bed-date-display';
                // 格式化日期顯示
                const formattedDate = formatDate(reservation.date);
                dateDisplay.textContent = formattedDate;
                
                const noteDisplay = document.createElement('div');
                noteDisplay.className = 'research-bed-note-display';
                noteDisplay.textContent = reservation.note || '(無備註)';
                
                info.appendChild(dateDisplay);
                info.appendChild(noteDisplay);
                
                const deleteBtn = document.createElement('div');
                deleteBtn.className = 'research-bed-delete';
                deleteBtn.textContent = '×';
                deleteBtn.onclick = () => deleteResearchBedReservation(reservation.id);
                
                item.appendChild(info);
                item.appendChild(deleteBtn);
                
                listElement.appendChild(item);
            });
        }

        // 格式化日期
        function formatDate(dateString) {
            const date = new Date(dateString);
            const year = date.getFullYear();
            const month = (date.getMonth() + 1).toString().padStart(2, '0');
            const day = date.getDate().toString().padStart(2, '0');
            
            // 获取星期几
            const weekdays = ['日', '一', '二', '三', '四', '五', '六'];
            const weekday = weekdays[date.getDay()];
            
            return `${year}/${month}/${day} (${weekday})`;
        }

        // 保存预约數據
        function saveResearchBedData() {
            localStorage.setItem('researchBedReservations', JSON.stringify(researchBedReservations));
        }

        // 加載预约數據
        function loadResearchBedData() {
            const savedData = localStorage.getItem('researchBedReservations');
            if (savedData) {
                researchBedReservations = JSON.parse(savedData);
                updateResearchBedList();
            }
        }

        // 在頁面加載時初始化
        document.addEventListener('DOMContentLoaded', function() {
            // 其他初始化代碼...
            
            // 加載预约研究床號數據
            loadResearchBedData();
        });

        // 添加床號概覽的切換功能
        const bedOverview = document.querySelector('.bed-overview');
        const toggleButton = document.getElementById('toggleBedOverview');
        let isOverviewVisible = false;

        toggleButton.onclick = function() {
            isOverviewVisible = !isOverviewVisible;
            bedOverview.classList.toggle('show');
            document.body.classList.toggle('overview-hidden');
            this.textContent = isOverviewVisible ? '隱藏床號概覽' : '顯示床號概覽';
            
            if (isOverviewVisible) {
                document.body.style.paddingBottom = '400px';
            } else {
                document.body.style.paddingBottom = '150px';
            }
        };

        // 修改床號概覽的樣式
        const bedOverviewStyle = document.createElement('style');
        bedOverviewStyle.textContent = `
            .bed-overview.show {
                position: fixed;
                bottom: 100px;
                max-height: 300px;
                overflow: hidden;
            }
        `;
        document.head.appendChild(bedOverviewStyle);

        // 追踪當前選中的班別區域
        let currentShift = null;

        // 為每個班別區域添加點擊事件
        document.querySelectorAll('.shift-section').forEach(section => {
            section.addEventListener('click', function() {
                document.querySelectorAll('.shift-section').forEach(s => 
                    s.style.borderColor = '#2196f3');
                this.style.borderColor = '#4caf50';
                currentShift = this.querySelector('.shift-title').textContent;
            });
        });

        // 修改新增組別按鈕的處理
        document.getElementById('addGroupButton').onclick = function() {
            if (!currentShift) {
                alert('請先選擇要新增組別的班別');
                return;
            }
            addCareGroup(currentShift);
        };
    </script>
</body>
</html>

